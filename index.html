<!DOCTYPE html>
<html>
<head>
  <title>Snow Game</title>
  <style>
    body { margin: 0; padding: 0; }
    canvas { border: 4px solid black; }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
  <canvas id="gameCanvas" width="3200" height="1440"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let gameState = 'selectCharacter', playerEmoji = null, scrollX = 0;
    let player = { x: 50, y: 960, width: 50, height: 50, vx: 10, vy: 0, gravity: 0.5, jump: -10, grounded: false, jumping: false };
    let hills = [{x: 0, y: 960}, {x: 500, y: 960}];
    let animals = ["🐧", "🐆", "🦌"];
    let touchStartX, touchStartY, touchEndX, touchEndY;
    let bgHills = [{x: 0, y: 960}, {x: 500, y: 960}];
    let bgEmojiList = ["🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲", "🌲"];
    let bgEmojis = [];
    let snowflakes = [];

    // Event listeners for touchstart and touchend
    canvas.addEventListener("touchstart", function(e) {
      e.preventDefault();
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
      if (gameState === 'selectCharacter') {
        if (touch.clientX >= 600 && touch.clientX <= 900 && touch.clientY >= 400 && touch.clientY <= 700) {
          playerEmoji = "⛷️";
          gameState = 'play';
        } else if (touch.clientX >= 1400 && touch.clientX <= 1700 && touch.clientY >= 400 && touch.clientY <= 700) {
          playerEmoji = "🏂";
          gameState = 'play';
        }
      }
    });

    canvas.addEventListener("touchend", function(e) {
      e.preventDefault();
      const touch = e.changedTouches[0];
      touchEndX = touch.clientX;
      touchEndY = touch.clientY;
      if (gameState !== 'selectCharacter') {
        const deltaX = touchEndX - touchStartX;
        const deltaY = touchEndY - touchStartY;
        if (Math.abs(deltaX) > Math.abs(deltaY)) {
          if (deltaX > 0) {
            player.x += 50;
          } else {
            player.x -= 50;
          }
        } else {
          if (deltaY < 0 && player.grounded) {
            player.vy = player.jump;
            player.grounded = false;
            player.jumping = true;
          }
        }
      }
    });

    const draw = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (gameState === 'selectCharacter') {
        ctx.font = "300px Arial";
        ctx.fillText("⛷️", 750, 700);
        ctx.fillText("or", 1000, 700);
        ctx.fillText("🏂", 1550, 700);
      } else {
        ctx.fillStyle = "skyblue";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        snowflakes.forEach(snowflake => {
          ctx.fillStyle = "white";
          ctx.globalAlpha = snowflake.opacity;
          ctx.beginPath();
          ctx.arc(snowflake.x - scrollX, snowflake.y, snowflake.size, 0, Math.PI * 2);
          ctx.fill();
          ctx.globalAlpha = 1;
        });

        ctx.fillStyle = "white";
        ctx.fillRect(0, 960, canvas.width, canvas.height - 960);

        ctx.save();
        ctx.translate(player.x - scrollX + player.width / 2, player.y + player.height / 2);
        ctx.scale(-1, 1);
        ctx.font = "144px Arial";
        ctx.fillText(playerEmoji, -player.width / 2, -player.height / 2);
        ctx.restore();
      }
    };

    const update = () => {
      if (gameState !== 'selectCharacter') {
        player.y += player.vy;
        player.vy += player.gravity;
        player.grounded = false;

        snowflakes.forEach(snowflake => {
          snowflake.y += snowflake.speed;
          if (snowflake.y > canvas.height) {
            snowflake.y = 0;
            snowflake.x = Math.random() * canvas.width;
          }
        });

        if (player.y >= 960) {
          player.y = 960;
          player.vy = 0;
          player.grounded = true;
          player.jumping = false;
        }
      }
    };

    for (let i = 0; i < 10; i++) {
      const size = Math.random() * 8 + 4;
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height;
      const speed = Math.random() * 0.5 + 0.1;
      const opacity = Math.random() * 0.5 + 0.5;
      snowflakes.push({ size, x, y, speed, opacity });
    }

    const gameLoop = () => {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    };

    gameLoop();
  </script>
</body>
</html>
